id: brief-2024-01-03-aws-ecr-container-scanning
slug: 2024-01-aws-ecr-container-scanning
title: AWS ECR Container Scanning Findings Detection
summary: This brief covers detecting potentially malicious container images within AWS Elastic Container Registry (ECR) based on findings from container image scanning.
severity: medium
published_at: "2024-01-03T12:00:00Z"
content: |
    ## Overview

    This threat brief focuses on the detection of malicious or vulnerable container images within Amazon Elastic Container Registry (ECR). While the provided source material is limited, the general concept is important for cloud security. Attackers may attempt to inject malicious code or known vulnerabilities into container images stored in ECR to compromise applications deployed using these images. Successful exploitation can lead to data breaches, service disruption, or complete system compromise. Defenders need to monitor ECR scan results to quickly identify and remediate vulnerable images before they are deployed. This detection strategy leverages the inherent scanning capabilities of AWS ECR.

    ## Attack Chain

    1. An attacker gains unauthorized access to an AWS account or obtains credentials with sufficient permissions to push images to ECR.
    2. The attacker crafts a malicious container image, potentially containing malware, backdoors, or known exploitable vulnerabilities.
    3. The attacker pushes the malicious container image to a target ECR repository.
    4. AWS ECR automatically scans the newly uploaded image for vulnerabilities and malware.
    5. The scan generates findings, which may include high severity vulnerabilities or malware detections.
    6. A detection rule triggers based on the high severity findings generated by the ECR scan.
    7. Security teams investigate the flagged image and determine the appropriate remediation steps.
    8. Remediation may involve removing the image, patching vulnerabilities, or rebuilding the image from a trusted source.

    ## Impact

    Compromised container images in ECR can lead to significant security breaches. If a vulnerable image is deployed, it could allow attackers to gain a foothold within the infrastructure. This can result in data theft, denial of service, or complete control of the affected application or system. The severity of the impact depends on the role and permissions of the containerized application. Successfully exploiting a vulnerability could lead to lateral movement within the cloud environment, potentially impacting multiple services and data stores.
tags:
    - cloud
    - aws
    - container
    - ecr
references:
    - https://github.com/splunk/security_content/blob/main/detections/cloud/aws_ecr_container_scanning_findings_high.yml
rules:
    - title: Detect High Severity AWS ECR Container Scanning Findings
      description: Detects high severity findings reported by AWS ECR container scanning.
      logsource:
        category: cloudtrail
        product: aws
      detection:
        condition: selection
        selection:
            eventName: DescribeImageScanFindings
            eventSource: ecr.amazonaws.com
            severity: HIGH
      level: high
      tags:
        - attack.defense_evasion
        - attack.t1562.004
      tests:
        positive:
            - name: ECR scan finding with high severity
              data:
                - eventName: DescribeImageScanFindings
                  eventSource: ecr.amazonaws.com
                  findingArn: arn:aws:inspector2:us-west-2:123456789012:finding/1234abcd-12ab-34cd-56ef-1234567890ab
                  severity: HIGH
        negative:
            - name: ECR scan finding with low severity
              data:
                - eventName: DescribeImageScanFindings
                  eventSource: ecr.amazonaws.com
                  findingArn: arn:aws:inspector2:us-west-2:123456789012:finding/1234abcd-12ab-34cd-56ef-1234567890ab
                  severity: LOW
    - title: Detect AWS ECR Push Image without Scan
      description: Detects an attempt to push a container image to AWS ECR without subsequent scanning.
      logsource:
        category: cloudtrail
        product: aws
      detection:
        condition: selection_push and not selection_scan
        selection_push:
            eventName: PutImage
            eventSource: ecr.amazonaws.com
        selection_scan:
            eventName: StartImageScan
            eventSource: ecr.amazonaws.com
      level: low
      tags:
        - attack.defense_evasion
        - attack.t1562.004
      tests:
        positive:
            - name: ECR push image without scan
              data:
                - eventName: PutImage
                  eventSource: ecr.amazonaws.com
                  imageTag: latest
                - eventName: GetAuthorizationToken
                  eventSource: ecr.amazonaws.com
        negative:
            - name: ECR push image followed by scan
              data:
                - eventName: PutImage
                  eventSource: ecr.amazonaws.com
                  imageTag: latest
                - eventName: StartImageScan
                  eventSource: ecr.amazonaws.com
                  imageTag: latest
ttps:
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1069
      technique_name: Standard Security Tools
    - tactic_id: TA0040
      tactic_name: Impact
      technique_id: T1499
      technique_name: Endpoint Denial of Service
