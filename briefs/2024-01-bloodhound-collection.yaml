id: brief-2024-01-02-bloodhound-collection
slug: 2024-01-bloodhound-collection
title: BloodHound Data Collection Activity
summary: The BloodHound tool is being used by attackers to enumerate Active Directory environments, potentially for privilege escalation and lateral movement.
severity: high
published_at: "2024-01-02T12:00:00Z"
content: |
    ## Overview

    BloodHound is a popular open-source tool used to map relationships within Active Directory environments. While often employed by security professionals for penetration testing and security assessments, it is also leveraged by malicious actors to identify attack paths for privilege escalation and lateral movement. The SharpHound ingestor is used to collect data, which is then analyzed using the BloodHound interface. The presence of BloodHound collection files (JSON and ZIP) on a system indicates potential reconnaissance activity by an attacker seeking to understand and exploit Active Directory weaknesses. This activity could be an early stage of a larger attack, such as ransomware deployment or data exfiltration. Defenders should monitor for the creation of these files to identify potential malicious activity.

    ## Attack Chain

    1.  An attacker gains initial access to a system within the target Active Directory environment.
    2.  The attacker executes SharpHound, a data collector for BloodHound, using PowerShell or other scripting methods (attack.t1059.001).
    3.  SharpHound enumerates the Active Directory environment, querying information about users, groups, computers, organizational units (OUs), Group Policy Objects (GPOs), and containers (attack.discovery, attack.t1087.001, attack.t1087.002, attack.t1482, attack.t1069.001, attack.t1069.002).
    4.  The collected data is stored in JSON files with specific naming conventions, such as `_users.json`, `_computers.json`, `_gpos.json`, `_groups.json`, `_ous.json`, and `_containers.json`.
    5.  Optionally, the attacker may compress the JSON files into a `BloodHound.zip` archive for easier transport.
    6.  The attacker may stage these data files locally before exfiltration.
    7.  The attacker exfiltrates the collected data to an external server or storage location.
    8.  The attacker analyzes the BloodHound data to identify attack paths for privilege escalation, lateral movement, and ultimately, achieving their objectives within the Active Directory environment.

    ## Impact

    Successful execution of BloodHound and subsequent analysis of the collected data can provide attackers with a detailed map of the Active Directory environment. This allows them to identify vulnerable accounts, misconfigured permissions, and potential attack paths to escalate privileges and move laterally across the network. This information can be used to compromise critical systems, steal sensitive data, or deploy ransomware. The impact can range from data breaches and financial losses to significant operational disruption.
tags:
    - active-directory
    - bloodhound
    - reconnaissance
    - privilege-escalation
references:
    - https://academy.hackthebox.com/course/preview/active-directory-bloodhound/bloodhound--data-collection
    - https://github.com/SigmaHQ/sigma/blob/main/rules/windows/file/file_event/file_event_win_bloodhound_collection.yml
rules:
    - title: Detect BloodHound Data Collection - JSON File Creation
      description: Detects the creation of JSON files commonly generated by SharpHound during BloodHound data collection.
      logsource:
        category: file_event
        product: windows
      detection:
        condition: selection and not 1 of filter_optional_*
        filter_optional_ms_winapps:
            Image|endswith: \svchost.exe
            TargetFilename|endswith: \pocket_containers.json
            TargetFilename|startswith: C:\Program Files\WindowsApps\Microsoft.
        selection:
            TargetFilename|endswith:
                - _users.json
                - _computers.json
                - _gpos.json
                - _groups.json
                - _ous.json
                - _containers.json
      level: high
      tags:
        - attack.discovery
        - attack.t1087.001
        - attack.t1087.002
        - attack.t1482
        - attack.t1069.001
        - attack.t1069.002
      tests:
        positive:
            - name: BloodHound JSON file creation
              data:
                - Image: C:\Windows\System32\cmd.exe
                  TargetFilename: C:\Users\Public\_users.json
        negative:
            - name: Legitimate file creation
              data:
                - Image: C:\Windows\System32\notepad.exe
                  TargetFilename: C:\Windows\Temp\normal.txt
    - title: Detect BloodHound Data Collection - ZIP Archive Creation
      description: Detects the creation of a ZIP archive named BloodHound.zip, commonly used to store collected BloodHound data.
      logsource:
        category: file_event
        product: windows
      detection:
        condition: selection
        selection:
            TargetFilename|endswith: BloodHound.zip
      level: high
      tags:
        - attack.discovery
        - attack.t1087.001
        - attack.t1087.002
        - attack.t1482
        - attack.t1069.001
        - attack.t1069.002
      tests:
        positive:
            - name: BloodHound ZIP archive creation
              data:
                - Image: C:\Windows\System32\cmd.exe
                  TargetFilename: C:\Users\Public\BloodHound.zip
        negative:
            - name: Normal ZIP archive creation
              data:
                - Image: C:\Windows\System32\explorer.exe
                  TargetFilename: C:\Users\Public\archive.zip
ttps:
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1087
      technique_name: Account Discovery
      subtechnique_id: T1087.001
      subtechnique_name: Local Account
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1087
      technique_name: Account Discovery
      subtechnique_id: T1087.002
      subtechnique_name: Domain Account
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1482
      technique_name: Domain Trust Discovery
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1069
      technique_name: Permission Groups Discovery
      subtechnique_id: T1069.001
      subtechnique_name: Local Groups
    - tactic_id: TA0007
      tactic_name: Discovery
      technique_id: T1069
      technique_name: Permission Groups Discovery
      subtechnique_id: T1069.002
      subtechnique_name: Domain Groups
    - tactic_id: TA0002
      tactic_name: Execution
      technique_id: T1059
      technique_name: Command and Scripting Interpreter
      subtechnique_id: T1059.001
      subtechnique_name: PowerShell
