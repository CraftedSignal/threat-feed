id: brief-2024-01-31-okta-credential-access
slug: 2024-01-31-okta-credential-access
title: Okta Successful Login After Credential Attack
summary: This detection identifies successful Okta logins following a potential credential compromise, indicating successful credential access and potential lateral movement.
severity: high
published_at: "2024-01-31T12:00:00Z"
content: |
    ## Overview

    This detection focuses on identifying successful Okta logins that occur shortly after a potential credential attack. While the provided source material lacks detailed context on specific threat actors or campaigns, the core concept revolves around detecting successful logins following suspicious activities that could indicate credential compromise. This could include brute-force attempts, password spraying, or credential stuffing attacks. Defenders should prioritize investigating these events as they may indicate a breach and potential for further malicious activity within the Okta environment and connected services. The absence of specific details in the source highlights the need for generic detections that can identify suspicious patterns regardless of the specific attack vector.

    ## Attack Chain

    1.  **Credential Harvesting:** Attacker obtains user credentials through phishing, malware, or data breaches outside of the Okta environment.
    2.  **Brute-Force/Password Spraying:** The attacker attempts to guess user passwords, possibly using a list of commonly used passwords. While this is not directly mentioned in the source, it's a common precursor to successful login.
    3.  **Initial Login Attempt:** The attacker attempts to log in to Okta using the compromised credentials, potentially triggering Okta's security mechanisms (e.g., MFA).
    4.  **Successful Authentication:** The attacker bypasses or circumvents security measures, potentially through social engineering or by exploiting vulnerabilities.
    5.  **Privilege Escalation (Potential):** Once logged in, the attacker may attempt to escalate privileges within Okta or connected applications.
    6.  **Lateral Movement (Potential):** The attacker uses the compromised Okta account to access other applications and resources within the organization's environment.
    7.  **Data Exfiltration/Malicious Activity (Potential):** The attacker uses the access gained to exfiltrate sensitive data or perform other malicious actions.

    ## Impact

    Successful credential access can lead to significant damage, including data breaches, financial loss, and reputational damage. If an attacker gains access to an Okta account, they can potentially access all applications and resources connected to Okta, impacting potentially hundreds or thousands of users. The severity of the impact depends on the privileges associated with the compromised account and the sensitivity of the data that can be accessed.
tags:
    - credential-access
    - okta
    - lateral-movement
references:
    - https://github.com/elastic/detection-rules/blob/main/rules/integrations/okta/credential_access_okta_successful_login_after_credential_attack.toml
rules:
    - title: Okta Successful Login After Multiple Failed Attempts
      description: Detects successful Okta logins immediately following multiple failed login attempts, suggesting a possible credential compromise.
      logsource:
        category: authentication
        product: okta
      detection:
        condition: selection_failed AND selection_success
        selection_failed:
            event.outcome: failure
        selection_success:
            event.outcome: success
        timeframe: 5m
      level: high
      tags:
        - attack.credential_access
        - attack.t1110
      tests:
        positive:
            - name: Successful login after failed attempts
              data:
                - event.outcome: failure
                  user.login: testuser@example.com
                - event.outcome: failure
                  user.login: testuser@example.com
                - event.outcome: success
                  user.login: testuser@example.com
        negative:
            - name: Successful login without failed attempts
              data:
                - event.outcome: success
                  user.login: normaluser@example.com
    - title: Okta Login from New Location After Failed Attempts
      description: Detects successful Okta logins from a previously unseen geographic location after multiple failed login attempts.
      logsource:
        category: authentication
        product: okta
      detection:
        condition: selection_failed AND selection_success AND location_change
        location_change:
            geo.country_iso_code: '*'
        selection_failed:
            event.outcome: failure
        selection_success:
            event.outcome: success
        timeframe: 5m
      level: medium
      tags:
        - attack.credential_access
        - attack.t1110
        - attack.t1078
      tests:
        positive:
            - name: Successful login from new location after failed attempts
              data:
                - event.outcome: failure
                  geo.country_iso_code: US
                  user.login: testuser@example.com
                - event.outcome: failure
                  geo.country_iso_code: US
                  user.login: testuser@example.com
                - event.outcome: success
                  geo.country_iso_code: CA
                  user.login: testuser@example.com
        negative:
            - name: Successful login from known location
              data:
                - event.outcome: success
                  geo.country_iso_code: US
                  user.login: normaluser@example.com
ttps:
    - tactic_id: TA0006
      tactic_name: Credential Access
      technique_id: T1078
      technique_name: Valid Accounts
