id: brief-2024-01-30-okta-password-spray
slug: 2024-01-30-okta-password-spray
title: Okta Password Spraying Detection
summary: Password spraying against Okta accounts can lead to unauthorized access and potential data breaches.
severity: high
published_at: "2024-01-30T12:00:00Z"
content: |
    ## Overview

    This brief focuses on detecting password spraying attacks targeting Okta user accounts. Password spraying involves attempting to log in to multiple accounts with a list of common passwords. While the provided source does not contain specific attack details, it highlights the importance of detecting such activity. Since the source is a pointer to a detection rule, we can infer that password spraying against Okta is a concern that needs to be addressed. This activity, if successful, can compromise user accounts, leading to data breaches, internal network access, and other malicious activities.

    ## Attack Chain

    1.  Attacker identifies a list of valid usernames for an Okta organization, potentially through OSINT or previous breaches.
    2.  The attacker uses a password spraying tool or script to attempt logins to multiple Okta accounts using a list of common or default passwords.
    3.  The login attempts originate from multiple IP addresses or user agents to evade simple rate limiting or account lockout policies.
    4.  Okta logs record numerous failed login attempts for different user accounts from similar IP addresses or user agents within a short timeframe.
    5.  A successful login occurs from one of the sprayed accounts.
    6.  The attacker leverages the compromised Okta account to access applications and resources connected to the Okta tenant.
    7.  Attacker escalates privileges within the accessed applications or resources.
    8.  The attacker exfiltrates sensitive data or performs other malicious actions.

    ## Impact

    A successful password spraying attack can lead to widespread account compromise within an organization. This can result in data breaches, financial loss, reputational damage, and disruption of business operations. The number of affected users can range from a few individuals to entire departments, depending on the attacker's objectives and the scope of the attack. Sectors most vulnerable are those relying heavily on Okta for identity and access management, including technology, finance, and healthcare.
tags:
    - password-spraying
    - credential-access
    - okta
references:
    - https://github.com/elastic/detection-rules/blob/main/rules/integrations/okta/credential_access_okta_password_spray_multi_source.toml
rules:
    - title: Okta Multiple Failed Logins from Single IP
      description: Detects multiple failed Okta login attempts from a single IP address, indicative of password spraying.
      logsource:
        category: network_connection
        product: okta
      detection:
        aggregation:
            DestinationIp:
                - DestinationIp
            count:
                - count()
            interval: 5m
        condition: selection and count > 10
        selection:
            event.outcome: failure
      level: medium
      tags:
        - attack.credential_access
        - attack.t1110.003
      tests:
        positive:
            - name: Multiple failed logins from one IP
              data:
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
        negative:
            - name: Few failed logins from one IP
              data:
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
    - title: Okta Multiple Failed Logins for Different Users
      description: Detects multiple failed Okta login attempts against different usernames from a single IP address.
      logsource:
        category: network_connection
        product: okta
      detection:
        aggregation:
            DestinationIp:
                - DestinationIp
            count:
                - count()
            interval: 5m
            user.name:
                - user.name
        condition: selection and count > 5
        selection:
            event.outcome: failure
      level: high
      tags:
        - attack.credential_access
        - attack.t1110.003
      tests:
        positive:
            - name: Multiple failed logins for different users from one IP
              data:
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user1@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user2@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user3@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user4@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user5@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user6@example.com
        negative:
            - name: Few failed logins for different users from one IP
              data:
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user1@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user2@example.com
                - DestinationIp: 192.0.2.1
                  event.outcome: failure
                  user.name: user3@example.com
ttps:
    - tactic_id: TA0006
      tactic_name: Credential Access
      technique_id: T1110
      technique_name: Brute Force
      subtechnique_id: T1110.003
      subtechnique_name: Password Spraying
