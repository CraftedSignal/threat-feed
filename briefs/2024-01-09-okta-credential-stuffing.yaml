id: brief-2024-01-09-okta-credential-stuffing
slug: 2024-01-09-okta-credential-stuffing
title: Okta Credential Stuffing Attempt Detection
summary: Detection of potential credential stuffing attacks against Okta user accounts originating from a single source IP address.
severity: medium
published_at: "2024-01-09T12:00:00Z"
content: |
    ## Overview

    This brief focuses on detecting potential credential stuffing attacks targeting Okta environments. Credential stuffing involves attackers using lists of compromised usernames and passwords obtained from previous data breaches to attempt unauthorized access to user accounts on other platforms, including Okta. The goal is to identify patterns indicative of this type of attack, specifically those originating from a single IP address to reduce false positives and focus on targeted attacks. While the source doesn't specify a particular campaign or actor, the detection strategy is broadly applicable to various credential stuffing attempts against Okta. The lack of specific version numbers or tool names in the source necessitates a focus on behavioral indicators rather than specific signatures. Defenders should prioritize monitoring for unusual login patterns and potential brute-force attacks against user accounts.

    ## Attack Chain

    1. **Credential Acquisition:** The attacker obtains a list of compromised usernames and passwords from previous data breaches or dark web sources.
    2. **Target Identification:** The attacker identifies Okta as a target platform.
    3. **Login Attempt Initiation:** The attacker initiates login attempts to multiple Okta user accounts using the compromised credentials, all originating from a single IP address.
    4. **Authentication Request:** Okta receives authentication requests for multiple users from the same source IP within a short time frame.
    5. **Failed Login Attempts:** The majority of the login attempts fail due to incorrect credentials.
    6. **Potential Account Lockout:** Repeated failed login attempts may trigger Okta's account lockout policies, temporarily disabling affected user accounts.
    7. **Successful Authentication (Rare):** In some cases, a compromised username and password combination may be valid, granting the attacker unauthorized access to an Okta user account.

    ## Impact

    Successful credential stuffing attacks can lead to unauthorized access to sensitive data and systems protected by Okta. This can result in data breaches, financial loss, and reputational damage. While the exact number of victims is unknown, the potential impact is significant, especially for organizations heavily reliant on Okta for identity and access management. The sectors most at risk are those that handle sensitive user data, such as financial services, healthcare, and government agencies. Failure to detect and mitigate credential stuffing attacks can compromise the security of entire organizations and their users.
tags:
    - credential-stuffing
    - okta
    - authentication
references:
    - https://github.com/elastic/detection-rules/blob/main/rules/integrations/okta/credential_access_okta_credential_stuffing_single_source.toml
rules:
    - title: Okta Multiple Failed Logins from Single Source
      description: Detects multiple failed Okta login attempts from the same source IP address within a short time frame, indicative of credential stuffing.
      logsource:
        category: authentication
        product: okta
      detection:
        aggregation:
            client.ip:
                max: 5
                timeframe: 60
        condition: selection | aggregation
        selection:
            client.ip: '*'
            event.outcome: failure
      level: medium
      tags:
        - attack.credential_access
        - attack.t1110
      tests:
        positive:
            - name: Multiple failed logins from the same IP
              data:
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: failure
        negative:
            - name: Few failed logins from the same IP
              data:
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: failure
                - client.ip: 192.0.2.1
                  event.outcome: success
    - title: Okta First Time Login from New Location
      description: Detects first-time logins to Okta from a previously unseen location, potentially indicating compromised credentials.
      logsource:
        category: authentication
        product: okta
      detection:
        condition: selection
        selection:
            event.type: user.authentication.sso
            user.location.country: '*'
      level: low
      tags:
        - attack.credential_access
        - attack.t1078
      tests:
        positive:
            - name: First time login from unusual location
              data:
                - event.type: user.authentication.sso
                  user.location.country: RU
        negative:
            - name: Regular Login from known location
              data:
                - event.type: user.authentication.sso
                  user.location.country: US
ttps:
    - tactic_id: TA0006
      tactic_name: Credential Access
      technique_id: T1110
      technique_name: Brute Force
      subtechnique_id: T1110.003
      subtechnique_name: Credential Stuffing
