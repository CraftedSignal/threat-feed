id: brief-2024-01-30-fortigate-ssl-vpn-siem-alert
slug: 2024-01-30-fortigate-ssl-vpn-siem-alert
title: Fortigate SSL VPN Login Followed by SIEM Alert
summary: Detection of initial access via Fortigate SSL VPN login followed by a SIEM alert, indicating potential compromise.
severity: high
published_at: "2024-01-30T12:00:00Z"
content: |
    ## Overview

    This threat brief focuses on detecting initial access attempts through Fortigate SSL VPN, specifically when a successful login is immediately followed by a SIEM alert. This sequence of events suggests a potential account compromise or unauthorized access. The detection rule is designed to identify instances where a Fortigate SSL VPN login event is closely followed by a security alert generated by a SIEM, indicating potentially malicious activity post-VPN access. Defenders should investigate any such occurrences to confirm legitimacy and prevent further exploitation. While this brief is based on a general observation, its effective implementation can significantly enhance the timely detection of breaches and unauthorized access attempts in organizations relying on Fortigate SSL VPN solutions.

    ## Attack Chain

    1.  Attacker gains access to valid Fortigate SSL VPN credentials through phishing, credential stuffing, or other means.
    2.  Attacker successfully authenticates to the Fortigate SSL VPN using the compromised credentials.
    3.  Upon successful VPN connection, the attacker begins reconnaissance activities within the network, such as network scanning or attempts to access sensitive resources.
    4.  The attacker's reconnaissance activities trigger alerts in the SIEM system, such as unusual login locations, access to restricted resources, or suspicious network traffic patterns.
    5.  The SIEM system generates a high-priority alert based on the detected malicious activity following the VPN login.
    6.  The attacker may attempt to escalate privileges on compromised systems to gain further access to the network.
    7.  The attacker moves laterally within the network, compromising additional systems and accounts.

    ## Impact

    Successful exploitation can lead to significant damage, including data breaches, ransomware deployment, and intellectual property theft. Organizations using Fortigate SSL VPN are vulnerable if user credentials are compromised. The impact can range from a few compromised systems to a complete network takeover, depending on the attacker's capabilities and the organization's security posture. Early detection of these attacks is critical to minimize the impact and prevent further damage.
tags:
    - fortigate
    - sslvpn
    - initial_access
    - siem
references:
    - https://github.com/elastic/detection-rules/blob/main/rules/cross-platform/initial_access_fortigate_ssl_vpn_login_followed_by_siem_alert.toml
rules:
    - title: Fortigate SSL VPN Login Followed by SIEM Alert
      description: Detects a Fortigate SSL VPN login event followed by a SIEM alert within a short timeframe, indicating potential compromise.
      logsource:
        category: authentication
        product: fortigate
      detection:
        condition: vpn_login followed by siem_alert within 5m
        siem_alert:
            event.category: alert
            event.module: siem
            event.type: info
        vpn_login:
            event.category: authentication
            event.module: fortigate
            event.type: start
            log.message|contains: SSLVPN login
      level: high
      tags:
        - attack.initial_access
        - attack.t1190
      tests:
        positive:
            - name: Fortigate SSL VPN Login followed by SIEM Alert
              data:
                - event.category: authentication
                  event.module: fortigate
                  event.type: start
                  log.message: SSLVPN login user=testuser
                - event.category: alert
                  event.module: siem
                  event.type: info
                  log.message: Suspicious activity detected for user testuser
        negative:
            - name: Only Fortigate SSL VPN Login
              data:
                - event.category: authentication
                  event.module: fortigate
                  event.type: start
                  log.message: SSLVPN login user=testuser
    - title: Suspicious Activity After Fortigate SSL VPN Login
      description: Detects suspicious process creations shortly after a Fortigate SSL VPN login.
      logsource:
        category: process_creation
        product: windows
      detection:
        condition: vpn_login followed by suspicious_process within 10m
        suspicious_process:
            process.command_line|contains:
                - -enc
                - -EncodedCommand
            process.name|endswith:
                - powershell.exe
                - cmd.exe
            user.name: '*\${vpn_login.user.name}'
        vpn_login:
            event.category: authentication
            event.module: fortigate
            event.type: start
            log.message|contains: SSLVPN login
            user.name: '*'
      level: high
      tags:
        - attack.execution
        - attack.t1059.001
      tests:
        positive:
            - name: PowerShell Encoded Command after Fortigate VPN Login
              data:
                - event.category: authentication
                  event.module: fortigate
                  event.type: start
                  log.message: SSLVPN login user=testuser
                  user.name: domain\testuser
                - process.command_line: powershell.exe -enc SQBFAFgA...
                  process.name: powershell.exe
                  user.name: domain\testuser
        negative:
            - name: Legitimate PowerShell Usage
              data:
                - process.command_line: powershell.exe -File script.ps1
                  process.name: powershell.exe
                  user.name: domain\legituser
ttps:
    - tactic_id: TA0001
      tactic_name: Initial Access
      technique_id: T1190
      technique_name: Exploit Public Fasing Application
